# Magnetic field analysis tools for SOFIA/HAWC+ M51

## Summary
This repository contains the analysis tools used in the SOFIA Legacy Program publication "Extragalactic Magnetism with SOFIA (Legacy Program) I: The magnetic field in the multi-phase interstellar medium of M51", which is available on ArXiv on the following webpage: https://arxiv.org/abs/2105.09315. The tools contained in sofia_toolbox.py contain most of the software developed for the analysis of the far-infrared polarization observations of the M51 galaxy, plus the ancillary radio polarization observations from Fletcher et al. 2011 (https://ui.adsabs.harvard.edu/abs/2011MNRAS.412.2396F/abstract). 


## Functions

### plot_profile(profile, color, linestyle, linewidth, marker, label):
This function plots the magnetic pitch angle profile in an existing matplotlib figure using the profile objects generated with magnetic_pitch_angle function. 

### magnetic_pitch_angle_profile_plot(output_magnetic_pitch_angle_profile):
This is an auxiliary function to generate plots with the full output from magnetic_pitch_angle function. 

### measure_median_pitch_angle(pitch_angle_array):
This function uses the datacubes generated by magnetic_pitch_angle function to estimate the median pitch angle. Those datacubes contain the Montecarlo simulations used to estimate the errorbars for each pixel. 

Input: pitch_angle_array: A datacube generated by magnetic_pitch_angle containing the MonteCarlo simulations of the pitch angle arrays. 

def apply_mask(mode, mask_fits, header, I, dI, Q, dQ, U, dU):

def generate_pitch_model(pitch_profile, shape, header, xcen, ycen, PA, incl, output):

def save_fits(array, name, header=None):

def plot_pitch_model(I, pol_obs, pitch_model, SNR_int, SNR_pol, SNRi_cut = 10.0, SNRp_cut = 3.0, step=4,
                     scalevec = 2.5, header=None, save_fig="plot_pitch_model.pdf", vmin=None, vmax=None, alpha_model=1,
                     pol_fraction=None, title=" ", colorscale="viridis", color_model="red", color_obs="black", recenter=None, figsize=6.5, colorbar_label=r'Intensity (Jy arcsec$^{-2}$)'):
                     
def create_radial_mask(xsize, ysize, q=1, theta=0, center=None, radius=None):

def create_angle_mask(xsize, ysize, q, theta, center=None, radius=None, pitch=90):

def bootstrap_resample(X, weights=False, seed=None):

def median_angle(input_sample):

def bootmedian_angles(input_sample, nsimul, weights=False):


def rotated_polarization_angle(U, Q):

def inv_rotated_polarization_angle(pol90):

def single_magnetic_pitch_angle(xcen, ycen, I, dI, Q, dQ, U, dU, pol_level, dpol_level, PA, dPA, incl, dincl, nbins, nsimul,
                                save_temp=False, SNR_int_limit=5, SNR_pol_limit=1, plot_verbose=False, name="default_", header=None, bin_limits=None):
                                
def magnetic_pitch_angle(xcen, ycen, I, dI, Q, dQ, U, dU, PA, dPA, incl, dincl, nsimul=100,
                         nbins=10, plot_verbose=False, SNR_int_limit=5, SNR_pol_limit=1, name="default_", header=None, bin_limits=None, save_temp=False, force_bootmedian=False):
